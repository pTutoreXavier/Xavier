{% extends 'templates/app.twig' %}

{% block content %}

chercher par le nom d'un chercheur :
<input type="text" list="laListe" id="chercheur">
<datalist id="laListe"></datalist>
<input type="button" id="rechercher" value="rechercher">
<input type="button" id="mesVideos" value="Mes vidéos">
<table class="table mt-5" id="lesVideos">
	<thead class="thead-dark">
    <tr>
      <th scope="col">#</th>
      <th scope="col">Nom de la vidéo</th>
      <th scope="col">Vidéo</th>
    </tr>
  </thead>

</table>
{% endblock %}

{% block jshead %}

	<script type="text/javascript" src="{{ base_url() }}/jplayer/js/jquery.min.js"></script>

	<script type="text/javascript">
		$(document).ready(function(){
			let base = $("#lesVideos").html();
			loadVideos();
			$("#mesVideos").click(function(event){
				if($("#mesVideos").val() == "Mes vidéos"){
					$.ajax({
				        url : '../getVideosSearcher', // La ressource ciblée
				        type : 'GET', // Le type de la requête HTTP.
				        success : function(code_html, statut){
				       		let video = JSON.parse(code_html);
				       		let HTML = "";
				       		let cpt = 0;
				       		video.forEach(function(element){
				       			HTML += "<tr><td>" + (cpt+1) + "</td><td> " + element.lien + "</td><td><a href='../video/" + element.id + "'>Voir la vidéo</a></td></tr>";
				       			cpt++;
				       		});
				       		$("#lesVideos").html(base + HTML);
				        }
				    });
					$("#mesVideos").val("toute les vidéos");
				}
				else{
					$("#mesVideos").val("Mes vidéos");

					loadVideos();
				}
			});

			$("#chercheur").keyup(function(event){
				if($("#chercheur").val() != ""){
					$.ajax({
				        url : '../getSearcher/' + $("#chercheur").val(), // La ressource ciblée
				        type : 'GET', // Le type de la requête HTTP.
				        success : function(code_html, statut){
				       		let video = JSON.parse(code_html);
				       		let HTML = "";
				       		video.forEach(function(element){
				       			HTML += "<option value='" + element + "'>";
				       		});
				       		$("#laListe").html(HTML);
				        }
					});
				}
				
			});

			$("#rechercher").click(function(event){
				$.ajax({
			        url : '../VideosSearcher/' + $("#chercheur").val(), // La ressource ciblée
			        type : 'GET', // Le type de la requête HTTP.
			        success : function(code_html, statut){
			       		let video = JSON.parse(code_html);
			       		let HTML = "";
			       		let cpt = 0;
			       		video.forEach(function(element){
			       			console.log(element);
			       			HTML += "<tr><td>" + (cpt+1) + "</td><td> " + element.lien + "</td><td><a href='../video/" + element.id + "'>Voir la vidéo</a></td></tr>";
			       			cpt++;
			       		});
			       		$("#lesVideos").html(base + HTML);
			       		$("#chercheur").val("");
			       		$("#mesVideos").val("Mes vidéos");
			        }
				});
			});

			function loadVideos(){
				$.ajax({
			        url : '../getAllVideos', // La ressource ciblée
			        type : 'GET', // Le type de la requête HTTP.
			        success : function(code_html, statut){
			       		let video = JSON.parse(code_html);
			       		console.log(video);
			       		let cpt = 0;
			       		let HTML = "";
			       		video.forEach(function(element){
			       			HTML += "<tr><td>" + (cpt+1) + "</td><td> " + element.lien + "</td><td><a href='../video/" + element.id + "'>Voir la vidéo</a></td></tr>";
			       			cpt++;
			       		});
			       		$("#lesVideos").html(base + HTML);
			        }
				});
			}
		});
	</script>

{% endblock %}